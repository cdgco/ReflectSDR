<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>ReflectSDR</title>
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PMP47KR');</script>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.cyan-light_blue.min.css">
        <link rel="stylesheet" href="styles.css">
    </head>
    
    <body class="vsc-initialized">
        <div class="mdl-layout__container">
            <div class="demo-layout mdl-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
                <div class="mdl-layout__drawer mdl-color--blue-grey-900 mdl-color-text--blue-grey-50">
                <nav class="demo-navigation mdl-navigation mdl-color--blue-grey-800">
                  <a class="mdl-navigation__link" href=""><i class="mdl-color-text--blue-grey-400 material-icons">home</i>Home</a>
                </nav>
            </div>
            <main class="mdl-layout__content mdl-color--grey-100">
                <div class="mdl-grid">
                      <div class="mdl-color--grey-100 mdl-cell mdl-cell--12-col">
                           <center class="mdl-cell mdl-cell--12-col mdl-cell--12-col-desktop"> 
                                <div>
                                    <h2 style="color:#37474f;font-weight:500;">ReflectSDR</h2>
                                </div>
                            </center>
                        </div>
                        <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col">
                           <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-desktop"> 
                              <div style="color:#37474f">
                                    <center><h3>Directions</h3></center>
                                </div>
                              </div>
                        </div>
                        <div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
                           <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-desktop"> 
                              <div style="color:#37474f">
                                    <center>
                                    <ol style="width:fit-content;text-align: left">
                                        <li>Plug in RTL-SDR dongle</li>
                                        <li>Click the "Connect" button</li>
                                        <li>Click on your device from the pop-up</li>
                                        <li>Click the connect button in the pop-up window</li>
                                    </ol></center>
                                </div>
                              </div>
                        </div>
                        <div id="connect" class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
                           <center class="mdl-cell mdl-cell--12-col mdl-cell--12-col-desktop">
                               <button class="mdl-button mdl-button--raised mdl-button--accent;" style="background-color:#78909c ;color:white;">Connect</button> 
                            </center>
                        </div>
                        <div id="infoheader" style="display:none" class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col">
                           <div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-desktop">
                                <div style="color:#37474f">
                                    <center><h3>Device Info</h3></center>
                                </div> 
                            </div>
                        </div>
                        <div id="info" style="display:none" class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
                           <center class="mdl-cell mdl-cell--12-col mdl-cell--12-col-desktop">
                                    <p style="margin-top: 16px;">
                                        Manufacturer: <span id="vname"></span>    <br> 
                                        Manufacturer ID: <span id="1"></span>    <br> 
                                        Product: <span id="pname"></span>  <br>
                                        Product ID: <span id="2"></span>  <br> 
                                        Product Version: <span id="4"></span>  <br>   
                                        USB Version: <span id="5"></span>    <br>  
                                        <br>View Developer Console for more information.
                                    </p>  
                            </center>
                        </div>
                        <div id="error" style="display:none" class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
                           <center class="mdl-cell mdl-cell--12-col mdl-cell--12-col-desktop">
                                    <p style="margin-top: 16px;">
                                        Error connecting to RTL-SDR. Please ensure that the device is connected and is not in use by any other programs.
                                    </p>  
                            </center>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </body>
    <script>
        let connectButton = document.querySelector("#connect");
        connectButton.addEventListener('click', async function() {
            var device;


            navigator.usb.requestDevice({ filters: [{ 'vendorId': 3034, 'productId': 10296 }] }) // Select RTL-SDR Model 2838
            .then(selectedDevice => {
               device = selectedDevice;
               return device.open(); // Connect to device.
             })
            .then(() => device.selectConfiguration(1)) // Select configuration mode #1.
            .then(() => device.claimInterface(0)) // Request control over interface #0.
            .then(() => device.selectAlternateInterface(0, 0)) // Select Alernate #0 for interface #0.
            .then(() => {
                document.getElementById("error").style.display = "none";
                document.getElementById("info").style.display = "block";
                document.getElementById("pname").style.display = "none";
                document.getElementById("vname").style.display = "none";
                document.getElementById("infoheader").style.display = "block";
                if (device.productName != '') { document.getElementById("pname").innerHTML = device.productName; document.getElementById("pname").style.display = "block"; }
                if (device.manufacturerName != '') { document.getElementById("vname").innerHTML = device.manufacturerName; document.getElementById("vname").style.display = "block"; }
                document.getElementById("1").innerHTML = device.vendorId;
                document.getElementById("2").innerHTML = device.productId;
                document.getElementById("4").innerHTML = device.deviceVersionMajor + "." + device.deviceVersionMinor + "." + device.deviceVersionSubminor;
                document.getElementById("5").innerHTML = device.usbVersionMajor + "." + device.usbVersionMinor;
                document.getElementById("connect").style.display = "none";
                

                        })
            .then(() => console.log(device.configuration))
            .then(() => device.controlTransferIn({
                    requestType:'standard',recipient:'interface',request: 0,value: 1,index: 0 // Request data from interface #0, Channel #1 with a length of 2 and command of 0.
             }, 2))
            .then(result => { console.log(result.data); })
            .then(() => device.controlTransferIn({
                    requestType:'standard',recipient:'interface',request: 8,value: 1,index: 0
             }, 2))
            .then(result => { console.log(result.data); })
            .then(() => device.controlTransferIn({
                    requestType:'standard',recipient:'interface',request: 10,value: 1,index: 0
             }, 2))
            .then(result => { console.log(result.data); })
            .then(() => device.controlTransferIn({
                    requestType:'standard',recipient:'interface',request: 0,value: 1,index: 0
             }, 2))
            .then(() => { let SDRStream = device.transferIn(1, 512); // Request data from endpoint #1 with a block size of 512.
                        if(SDRStream) { console.log("Stream Started"); }})
             .catch(error => { document.getElementById("error").style.display = "block"; });

            });
    </script>
</html>
